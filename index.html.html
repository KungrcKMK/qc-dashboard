<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QC Report</title>
    
    <!-- 1. Load Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; background-color: #f8fafc; }
        .glass-card { background: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; }
        .gradient-header { background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white; }
        #root { min-height: 100vh; }
    </style>
</head>
<body>
    <div id="root">
        <div style="height: 100vh; display: flex; justify-content: center; align-items: center; flex-direction: column;">
            <div style="width: 50px; height: 50px; border: 5px solid #cbd5e1; border-top-color: #059669; border-radius: 50%; animation: spin 1s linear infinite;"></div>
            <div style="margin-top: 20px; font-weight: bold; color: #059669;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü...</div>
        </div>
    </div>

    <script type="text/babel">
        // --- 1. Check Libraries ---
        let Recharts = window.Recharts;
        if (!Recharts && window.Recharts && window.Recharts.default) Recharts = window.Recharts.default;
        if (!Recharts) throw new Error("Recharts not found");

        const { AreaChart, Area, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, PieChart, Pie, Cell } = Recharts;
        const { useState, useMemo, useEffect } = React;

        const API_URL = "https://script.google.com/macros/s/AKfycbx94cydYxN1bOSkDVFQlTxVY1QfNKi7AjmYlHOMo9exV9xioIs6vBvlE-GzLUuNY-AY5Q/exec";

        // --- 2. Offline Data ---
        const OFFLINE_DATA = [
            { date: "2026-02-15", time: "10:30", report: "as‡πÄ‡∏à‡∏≠‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏° ‡πÄ‡∏´‡∏°‡∏µ‡πà‡∏¢‡∏ß 1 ‡∏™‡πâ‡∏° 3 ‡∏û‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå 2 ‡∏Ñ‡πà‡∏∞ ‡πÉ‡∏ô‡∏•‡∏π‡∏Å‡∏ï‡∏≤‡∏•", category: "‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°/‡∏Ç‡∏ô" },
            { date: "2026-02-13", time: "09:00", report: "as‡πÄ‡∏à‡∏≠‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏° ‡∏û‡∏±‡∏í‡∏ô‡πå3 ‡∏à‡∏∏‡πâ‡∏°2 ‡πÄ‡∏´‡∏°‡∏µ‡πà‡∏¢‡∏ß 4 ‡∏™‡πâ‡∏° 2 ‡∏Ñ‡πà‡∏∞ ‡∏ï‡∏≠‡∏ô‡∏Ñ‡∏±‡∏î‡πÅ‡∏´‡πâ‡∏ß", category: "‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°/‡∏Ç‡∏ô" },
            { date: "2026-02-12", time: "15:02", report: "As‡πÅ‡∏°‡∏•‡∏á‡∏ù‡∏±‡πà‡∏á‡∏≠‡∏¢‡∏∏‡πà‡πÉ‡∏ô‡∏ß‡∏∏‡πâ‡∏ô‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß ‡∏Ñ‡∏ô‡∏´‡∏±‡πà‡∏ô‡πÄ‡∏à‡∏≠‡∏Ñ‡πà‡∏∞", category: "‡πÅ‡∏°‡∏•‡∏á/‡∏°‡∏î" },
            { date: "2026-02-12", time: "09:58", report: "As‡∏ú‡∏á‡∏î‡∏≥ ‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≤‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏•‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏à‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏∞", category: "‡∏™‡∏¥‡πà‡∏á‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô" },
            { date: "2026-02-11", time: "16:57", report: "as‡πÄ‡∏à‡∏≠‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏° ‡∏û‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå 2 ‡∏à‡∏∏‡πâ‡∏° 1 ‡πÄ‡∏´‡∏°‡∏µ‡πà‡∏¢‡∏ß 1 ‡∏Ñ‡πà‡∏∞ ‡πÉ‡∏ô‡∏ñ‡πâ‡∏ß‡∏¢‡∏•‡∏π‡∏Å‡∏ï‡∏≤‡∏•", category: "‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°/‡∏Ç‡∏ô" },
            { date: "2026-02-11", time: "16:56", report: "as‡πÄ‡∏à‡∏≠‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏° ‡∏û‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå 1 ‡∏à‡∏∏‡πâ‡∏° 1 ‡πÄ‡∏´‡∏°‡∏µ‡πà‡∏¢‡∏ß 1 ‡∏Ñ‡πà‡∏∞", category: "‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°/‡∏Ç‡∏ô" },
            { date: "2026-02-11", time: "15:26", report: "As‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏° ‡πÅ‡∏°‡∏•‡∏á ‡∏Ç‡∏¢‡∏∞‡∏î‡∏≥ ‡πÄ‡∏®‡∏©‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏ï‡∏¥‡∏î‡∏ß‡∏∏‡πâ‡∏ô‡∏•‡∏≠‡∏ô‡∏ï‡∏≤‡∏•‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°", category: "‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó" },
            { date: "2026-02-10", time: "16:25", report: "as‡πÄ‡∏à‡∏≠‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏° ‡πÄ‡∏´‡∏°‡∏µ‡πà‡∏¢‡∏ß 1 ‡∏™‡πâ‡∏° 1 ‡∏Ñ‡πà‡∏∞", category: "‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°/‡∏Ç‡∏ô" },
            { date: "2026-02-10", time: "12:22", report: "As‡∏Ç‡∏¢‡∏∞‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• ‡∏™‡∏µ‡∏î‡∏≥ ‡∏ß‡∏∏‡πâ‡∏ô‡∏¢‡∏≤‡∏ß ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏à‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏∞", category: "‡∏™‡∏¥‡πà‡∏á‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô" },
            { date: "2026-02-10", time: "12:21", report: "As‡πÄ‡∏®‡∏©‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡∏µ‡∏ü‡πâ‡∏≤ ‡∏Ç‡∏ô‡∏ï‡∏≤‡∏ï‡∏¥‡∏î‡∏ß‡∏∏‡πâ‡∏ô‡∏•‡∏≠‡∏ô‡∏ï‡∏≤‡∏•‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°", category: "‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å/‡∏¢‡∏≤‡∏á" },
            { date: "2026-02-10", time: "08:44", report: "As‡πÄ‡∏®‡∏©‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏ï‡∏¥‡∏î‡∏ß‡∏∏‡πâ‡∏ô‡∏•‡∏≠‡∏ô‡∏ï‡∏≤‡∏•‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° ‡∏Ñ‡∏ô‡∏ï‡∏±‡∏Å‡πÄ‡∏à‡∏≠‡∏Ñ‡πà‡∏∞", category: "‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å/‡∏¢‡∏≤‡∏á" },
            { date: "2023-03-23", time: "11:59", report: "as ‡πÄ‡∏à‡∏≠‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏¥‡∏î‡∏°‡∏≤‡∏Å‡∏±‡∏ö‡∏ß‡∏∏‡πâ‡∏ô‡∏Ñ‡πà‡∏∞ ‡∏Ñ‡∏ô‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏à‡∏≠ ‡∏ß‡∏∏‡πâ‡∏ô‡∏ì‡∏£‡∏á‡∏Ñ‡πå‡∏Ñ‡πà‡∏∞", category: "‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°/‡∏Ç‡∏ô" },
            { date: "2023-03-23", time: "08:27", report: "As‡πÄ‡∏à‡∏≠‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°‡∏ï‡∏¥‡∏î‡∏°‡∏≤‡∏Å‡∏±‡∏ö‡πÅ‡∏´‡πâ‡∏ß", category: "‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°/‡∏Ç‡∏ô" },
            { date: "2023-03-22", time: "17:20", report: "As ‡πÄ‡∏à‡∏≠‡∏°‡∏î‡∏≠‡∏¢‡∏∏‡πà‡πÉ‡∏ô‡∏ß‡∏∏‡πâ‡∏ô ‡∏Ñ‡∏∞ ‡∏ß‡∏∏‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏ô‡∏∏‡πà‡∏ô ‡∏Ñ‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏ß‡∏∏‡πâ‡∏ô‡πÄ‡∏à‡∏≠‡∏Ñ‡∏∞", category: "‡πÅ‡∏°‡∏•‡∏á/‡∏°‡∏î" },
            { date: "2023-03-22", time: "11:17", report: "As ‡πÄ‡∏à‡∏≠‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏ô ‡∏ï‡∏¥‡∏î‡∏°‡∏≤‡∏Å‡∏±‡∏ö‡∏ß‡∏∏‡πâ‡∏ô‡∏Ñ‡∏∞ ‡∏Ñ‡∏ô‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏à‡∏≠", category: "‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°/‡∏Ç‡∏ô" },
            { date: "2023-03-22", time: "08:58", report: "As‡πÄ‡∏à‡∏≠‡πÅ‡∏°‡∏•‡∏á‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ö‡∏ß‡∏∏‡πâ‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Ñ‡πà‡∏∞ ‡∏Ñ‡∏ô‡∏ï‡∏±‡∏Å‡πÄ‡∏à‡∏≠", category: "‡πÅ‡∏°‡∏•‡∏á/‡∏°‡∏î" },
            { date: "2023-03-21", time: "10:03", report: "as‡∏û‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°‡∏ï‡∏¥‡∏î‡∏°‡∏≤‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏ï‡∏≤‡∏•‡∏Ñ‡∏∞", category: "‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°/‡∏Ç‡∏ô" },
            { date: "2023-03-21", time: "09:46", report: "as‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°‡∏ï‡∏¥‡∏î‡∏°‡∏≤‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏ï‡∏≤‡∏•", category: "‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°/‡∏Ç‡∏ô" },
            { date: "2023-03-21", time: "07:49", report: "as‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°‡∏ï‡∏¥‡∏î‡∏°‡∏≤‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏ï‡∏≤‡∏•‡∏Ñ‡∏∞", category: "‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°/‡∏Ç‡∏ô" },
            { date: "2023-03-20", time: "10:54", report: "‡πÄ‡∏à‡∏≠ ‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏° ‡∏ï‡∏¥‡∏î‡∏°‡∏≤‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏ï‡∏≤‡∏•‡∏Ñ‡∏∞", category: "‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°/‡∏Ç‡∏ô" },
            { date: "2023-01-23", time: "14:30", report: "‡πÄ‡∏à‡∏≠‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏•‡∏≥‡πÑ‡∏¢‡∏Ñ‡πà‡∏∞ ‡∏Ñ‡∏ô‡πÉ‡∏™‡πà‡πÄ‡∏à‡∏≠", category: "‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°/‡∏Ç‡∏ô" },
            { date: "2023-01-23", time: "14:26", report: "‡πÄ‡∏à‡∏≠‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏ô‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏•‡∏≥‡πÑ‡∏¢‡∏Ñ‡πà‡∏∞ ‡∏Ñ‡∏ô‡πÉ‡∏™‡πà‡πÄ‡∏à‡∏≠", category: "‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°/‡∏Ç‡∏ô" },
            { date: "2023-01-23", time: "14:23", report: "‡πÄ‡∏à‡∏≠‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏•‡∏≥‡πÑ‡∏¢‡∏Ñ‡πà‡∏∞ ‡∏Ñ‡∏ô‡πÉ‡∏™‡πà‡πÄ‡∏à‡∏≠", category: "‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°/‡∏Ç‡∏ô" },
            { date: "2023-01-23", time: "14:17", report: "‡πÄ‡∏®‡∏©‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏™‡∏µ‡∏ü‡πâ‡∏≤ ‡∏ï‡∏¥‡∏î‡∏°‡∏≤‡∏Å‡∏±‡∏ö‡∏ß‡∏∏‡πâ‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Ñ‡∏∞", category: "‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å/‡∏¢‡∏≤‡∏á" },
            { date: "2023-01-23", time: "13:31", report: "‡πÄ‡∏à‡∏≠‡πÅ‡∏°‡∏•‡∏á‡∏ù‡∏±‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ß‡∏∏‡πâ‡∏ô‡∏Ñ‡πà‡∏∞ ‡∏ß‡∏∏‡πâ‡∏ô‡∏ô‡∏∏‡πà‡∏ô ‡∏Ñ‡∏ô‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏à‡∏≠‡∏Ñ‡πà‡∏∞", category: "‡πÅ‡∏°‡∏•‡∏á/‡∏°‡∏î" },
            { date: "2023-01-23", time: "13:30", report: "‡πÄ‡∏à‡∏≠‡∏´‡∏ô‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏•‡∏≥‡πÑ‡∏¢‡∏Ñ‡πà‡∏∞ ‡∏Ñ‡∏ô‡∏Ñ‡∏±‡∏î‡πÄ‡∏à‡∏≠ ‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏≥‡πÑ‡∏¢ lot 17/10/65", category: "‡πÅ‡∏°‡∏•‡∏á/‡∏°‡∏î" },
            { date: "2023-01-23", time: "13:27", report: "‡∏õ‡∏µ‡∏Å‡πÅ‡∏°‡∏•‡∏á‡∏ï‡∏¥‡∏î‡∏°‡∏≤‡∏Å‡∏±‡∏ö‡∏ñ‡πâ‡∏ß‡∏¢‡∏Ñ‡∏∞", category: "‡πÅ‡∏°‡∏•‡∏á/‡∏°‡∏î" },
            { date: "2023-01-23", time: "13:16", report: "‡πÄ‡∏à‡∏≠‡πÅ‡∏°‡∏•‡∏á‡∏ï‡∏¥‡∏î‡∏°‡∏≤‡∏Å‡∏±‡∏ö‡∏ï‡∏≤‡∏•‡πÄ‡∏Ç‡∏∑‡πà‡∏≠‡∏°‡∏Ñ‡∏∞", category: "‡πÅ‡∏°‡∏•‡∏á/‡∏°‡∏î" },
            { date: "2023-01-23", time: "08:15", report: "‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏ô ‡∏ï‡∏¥‡∏î‡∏°‡∏≤‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏ï‡∏≤‡∏•‡∏Ñ‡∏∞", category: "‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°/‡∏Ç‡∏ô" },
            { date: "2023-01-23", time: "08:09", report: "‡∏Ç‡∏≤‡πÅ‡∏°‡∏•‡∏á ‡∏ï‡∏¥‡∏î‡∏°‡∏≤‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏ï‡∏≤‡∏•‡∏Ñ‡∏∞", category: "‡πÅ‡∏°‡∏•‡∏á/‡∏°‡∏î" }
        ];

        const COLORS = ['#ef4444', '#f97316', '#facc15', '#22c55e', '#3b82f6', '#8b5cf6', '#ec4899'];

        // --- 3. Parser Logic ---
        const STAFF_NAMES = [
            '‡∏û‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå', '‡πÄ‡∏´‡∏°‡∏µ‡πà‡∏¢‡∏ß', '‡∏à‡∏∏‡πâ‡∏°', '‡∏™‡πâ‡∏°', '‡∏û‡∏±‡∏í‡∏ô‡πå', '‡πÄ‡∏£‡∏ì‡∏π', '‡πÄ‡∏û‡πá‡∏ç', '‡∏ï‡πà‡∏≤‡∏¢', '‡πÄ‡∏°‡πâ‡∏≤', 
            '‡∏¢‡∏≠‡∏á', '‡∏¢‡∏∏‡∏û‡∏¥‡∏ô', '‡∏™‡∏°‡∏ô‡∏∂‡∏Å', '‡∏ñ‡∏ô‡∏≠‡∏°', '‡∏Å‡πâ‡∏≠‡∏ô', '‡∏ï‡πà‡πä‡∏≠‡∏Å', '‡∏Ñ‡∏£‡∏π‡∏ö‡∏±‡∏á‡∏≠‡∏£', '‡∏•‡∏≠‡∏á', '‡πÄ‡∏¢‡∏≤‡∏ß‡πå', 
            '‡∏ô‡∏ß‡∏•', '‡πÄ‡∏£‡∏µ‡∏¢‡∏°', '‡∏´‡∏•‡∏á', '‡πÄ‡∏≠‡∏µ‡∏¢‡∏î', '‡πÅ‡∏Å‡∏•‡∏∞', '‡∏Å‡πâ‡∏≠‡∏á', '‡∏≠‡∏∏‡∏©‡∏≤', '‡∏ô‡πâ‡∏≠‡∏á', '‡πÅ‡∏ï', '‡∏™‡∏±‡∏ô', '‡∏Ñ‡∏∏‡πâ‡∏°'
        ];

        const parseStaffCounts = (reportText) => {
            let text = reportText.toLowerCase();
            const results = [];
            
            if (text.includes('‡πÄ‡∏™‡∏µ‡∏¢') || text.includes('‡πÄ‡∏ô‡πà‡∏≤')) return [];

            for (let name of STAFF_NAMES) {
                const regex = new RegExp(`(${name})\\s*[:=]?\\s*(\\d+)?`, 'g');
                let match;
                while ((match = regex.exec(text)) !== null) {
                    let foundName = name;
                    if (foundName === '‡∏û‡∏±‡∏í‡∏ô‡πå') foundName = '‡∏û‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå';
                    
                    const count = match[2] ? parseInt(match[2]) : 1; 
                    results.push({ name: foundName, count: count });
                    text = text.replace(match[0], ' '); 
                }
            }
            return results;
        };

        const classifyIssue = (text) => {
            if (!text) return "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏";
            const t = text.toLowerCase();
            if (t.includes('‡πÄ‡∏™‡∏µ‡∏¢') || t.includes('‡πÄ‡∏ô‡πà‡∏≤')) return 'IGNORE'; 
            if (t.includes('‡∏ú‡∏°') || t.includes('‡∏Ç‡∏ô')) return '‡πÄ‡∏™‡πâ‡∏ô‡∏ú‡∏°/‡∏Ç‡∏ô';
            if (t.includes('‡πÅ‡∏°‡∏•‡∏á') || t.includes('‡∏°‡∏î') || t.includes('‡∏´‡∏ô‡∏≠‡∏ô') || t.includes('‡∏¢‡∏∏‡∏á') || t.includes('‡πÅ‡∏°‡∏á')) return '‡πÅ‡∏°‡∏•‡∏á/‡∏°‡∏î';
            if (t.includes('‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å') || t.includes('‡∏ñ‡∏∏‡∏á') || t.includes('‡∏¢‡∏≤‡∏á')) return '‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å/‡∏¢‡∏≤‡∏á';
            if (t.includes('‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å') || t.includes('‡∏ü‡∏≤‡∏á') || t.includes('‡∏õ‡∏≠')) return '‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å/‡∏ü‡∏≤‡∏á';
            if (t.includes('‡πÇ‡∏•‡∏´‡∏∞') || t.includes('‡πÄ‡∏´‡∏•‡πá‡∏Å') || t.includes('‡∏™‡∏ô‡∏¥‡∏°') || t.includes('‡∏ï‡∏∞‡∏õ‡∏π')) return '‡πÇ‡∏•‡∏´‡∏∞/‡∏™‡∏ô‡∏¥‡∏°';
            if (t.includes('‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å') || t.includes('‡∏î‡∏≥') || t.includes('‡∏ù‡∏∏‡πà‡∏ô') || t.includes('‡∏Å‡∏≤‡∏Å')) return '‡∏™‡∏¥‡πà‡∏á‡πÄ‡∏à‡∏∑‡∏≠‡∏õ‡∏ô';
            return '‡∏≠‡∏∑‡πà‡∏ô‡πÜ';
        };

        const detectMaterial = (text) => {
            const t = text.toLowerCase();
            if (t.includes('‡∏•‡∏π‡∏Å‡∏ï‡∏≤‡∏•') || t.includes('‡∏ï‡∏≤‡∏•')) return '‡∏•‡∏π‡∏Å‡∏ï‡∏≤‡∏•';
            if (t.includes('‡πÅ‡∏´‡πâ‡∏ß')) return '‡πÅ‡∏´‡πâ‡∏ß';
            if (t.includes('‡∏ß‡∏∏‡πâ‡∏ô')) return '‡∏ß‡∏∏‡πâ‡∏ô';
            if (t.includes('‡∏•‡∏≥‡πÑ‡∏¢') || t.includes('‡∏•‡∏≥‡πÉ‡∏¢')) return '‡∏•‡∏≥‡πÑ‡∏¢';
            if (t.includes('‡πÅ‡∏°‡∏á‡∏•‡∏±‡∏Å')) return '‡πÅ‡∏°‡∏á‡∏•‡∏±‡∏Å';
            if (t.includes('‡∏•‡∏π‡∏Å‡∏•‡∏≤‡∏ô') || t.includes('‡∏•‡∏≤‡∏ô')) return '‡∏•‡∏π‡∏Å‡∏•‡∏≤‡∏ô';
            if (t.includes('‡∏£‡∏ß‡∏°‡∏°‡∏¥‡∏ï‡∏£')) return '‡∏£‡∏ß‡∏°‡∏°‡∏¥‡∏ï‡∏£';
            if (t.includes('‡∏°‡∏±‡∏ô')) return '‡∏°‡∏±‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°';
            return '‡∏≠‡∏∑‡πà‡∏ô‡πÜ/‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
        };

        const detectProcess = (text) => {
            const t = text.toLowerCase();
            if (t.includes('‡∏•‡πâ‡∏≤‡∏á')) return '‡∏•‡πâ‡∏≤‡∏á';
            if (t.includes('‡∏ï‡∏±‡∏Å')) return '‡∏ï‡∏±‡∏Å/‡∏ö‡∏£‡∏£‡∏à‡∏∏';
            if (t.includes('‡∏Ñ‡∏±‡∏î')) return '‡∏Ñ‡∏±‡∏î‡πÅ‡∏¢‡∏Å';
            if (t.includes('‡∏´‡∏±‡πà‡∏ô') || t.includes('‡∏ú‡πà‡∏≤')) return '‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°(‡∏´‡∏±‡πà‡∏ô/‡∏ú‡πà‡∏≤)';
            if (t.includes('‡πÉ‡∏™‡πà') || t.includes('‡∏Å‡∏£‡∏≠‡∏Å')) return '‡πÉ‡∏™‡πà/‡πÄ‡∏ï‡∏¥‡∏°';
            if (t.includes('‡πÄ‡∏Ñ‡∏≤‡∏∞')) return '‡πÄ‡∏Ñ‡∏≤‡∏∞';
            if (t.includes('‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏•‡∏ô‡πå') || t.includes('‡∏ã‡∏µ‡∏•') || t.includes('‡∏ï‡∏£‡∏ß‡∏à')) return 'QC/‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏•‡∏ô‡πå';
            return '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
        };

        const detectSupplier = (text) => {
            const t = text.toLowerCase();
            if (t.includes('‡∏ô‡∏∏‡πà‡∏ô')) return '‡∏ß‡∏∏‡πâ‡∏ô‡∏ô‡∏∏‡πà‡∏ô';
            if (t.includes('‡∏ì‡∏£‡∏á‡∏Ñ‡πå')) return '‡∏ß‡∏∏‡πâ‡∏ô‡∏ì‡∏£‡∏á‡∏Ñ‡πå';
            if (t.includes('‡πÄ‡∏•‡πá‡∏Å')) return '‡∏ß‡∏∏‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å';
            if (t.includes('‡∏≠‡∏≤‡∏£‡∏µ‡∏¢‡πå')) return '‡∏ß‡∏∏‡πâ‡∏ô‡∏≠‡∏≤‡∏£‡∏µ‡∏¢‡πå';
            if (t.includes('‡∏≠‡∏¥‡∏ô‡πÇ‡∏î')) return '‡∏ß‡∏∏‡πâ‡∏ô‡∏≠‡∏¥‡∏ô‡πÇ‡∏î';
            if (t.includes('‡∏´‡∏•‡∏¥‡∏ô')) return '‡∏ß‡∏∏‡πâ‡∏ô‡∏´‡∏•‡∏¥‡∏ô';
            if (t.includes('‡∏ó‡∏π‡πÄ‡∏Ñ')) return '‡∏ß‡∏∏‡πâ‡∏ô‡∏ó‡∏π‡πÄ‡∏Ñ';
            if (t.includes('cnn')) return '‡∏ñ‡∏∏‡∏á CNN';
            if (t.includes('‡πÄ‡∏Å‡∏©‡∏°')) return '‡∏•‡∏π‡∏Å‡∏•‡∏≤‡∏ô‡πÄ‡∏Å‡∏©‡∏°';
            return '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ';
        };

        // --- 4. Main Component ---
        const App = () => {
            const [rawData, setRawData] = useState(OFFLINE_DATA);
            const [processedData, setProcessedData] = useState([]);
            const [status, setStatus] = useState('offline');
            const [selectedYear, setSelectedYear] = useState('All');

            const processData = (sourceData) => {
                let processed = [];
                sourceData.forEach((item, originalIdx) => {
                    const category = classifyIssue(item.report);
                    if (category === 'IGNORE') return; 

                    const staffFound = parseStaffCounts(item.report);
                    const material = detectMaterial(item.report); 
                    const process = detectProcess(item.report);
                    const hour = parseInt(item.time.split(':')[0]); 

                    if (staffFound.length > 0) {
                        staffFound.forEach((staff, i) => {
                            processed.push({
                                ...item,
                                id: `${originalIdx}-${staff.name}-${i}`,
                                sourceName: `‡∏Ñ‡∏∏‡∏ì${staff.name}`,
                                sourceType: 'Staff',
                                category, material, process, hour,
                                count: staff.count
                            });
                        });
                    } else {
                        const supplierName = detectSupplier(item.report);
                        const isSupplier = supplierName !== '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ';
                        processed.push({
                            ...item,
                            id: originalIdx,
                            sourceName: isSupplier ? `Supplier: ${supplierName}` : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏',
                            sourceType: isSupplier ? 'Supplier' : 'Unknown',
                            category, material, process, hour,
                            count: 1
                        });
                    }
                });
                return processed;
            };

            const getRowSummary = (report) => {
                const category = classifyIssue(report);
                if (category === 'IGNORE') return null;
                const staffFound = parseStaffCounts(report);
                if (staffFound.length > 0) {
                    const totalCount = staffFound.reduce((sum, s) => sum + s.count, 0);
                    const breakdown = staffFound.map(s => `${s.name}(${s.count})`).join(", ");
                    return { totalCount, displaySource: breakdown, isStaff: true };
                } else {
                    return { totalCount: 1, displaySource: detectSupplier(report) !== '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ' ? detectSupplier(report) : detectProcess(report), isStaff: false };
                }
            };

            useEffect(() => {
                setProcessedData(processData(OFFLINE_DATA));
                fetch(API_URL)
                    .then(res => res.json())
                    .then(json => {
                        if (Array.isArray(json) && json.length > 0) {
                            setRawData(json);
                            setProcessedData(processData(json));
                            setStatus('online');
                        }
                    })
                    .catch(err => console.log("Online fetch failed"));
            }, []);

            const stats = useMemo(() => {
                const filtered = selectedYear === 'All' ? processedData : processedData.filter(d => d.date.startsWith(selectedYear));
                const total = filtered.reduce((sum, item) => sum + item.count, 0);
                
                // Helper to filter out "Unspecified"
                const filterUnknown = (dataArr) => {
                    const valid = [];
                    const invalid = [];
                    dataArr.forEach(d => {
                        if (d.name.includes('‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') || d.name.includes('‡∏≠‡∏∑‡πà‡∏ô‡πÜ') || d.name === '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ') {
                            invalid.push(d);
                        } else {
                            valid.push(d);
                        }
                    });
                    const invalidTotal = invalid.reduce((sum, i) => sum + i.value, 0);
                    return { valid, invalidTotal };
                };

                // Source Ranking
                const sourceCounts = {};
                filtered.forEach(d => sourceCounts[d.sourceName] = (sourceCounts[d.sourceName] || 0) + d.count);
                const sourceAll = Object.entries(sourceCounts).map(([name, value]) => ({ name, value })).sort((a,b) => b.value - a.value);
                const { valid: sourceData, invalidTotal: sourceUnknown } = filterUnknown(sourceAll);

                // Material Ranking
                const matCounts = {};
                filtered.forEach(d => matCounts[d.material] = (matCounts[d.material] || 0) + d.count);
                const matAll = Object.entries(matCounts).map(([name, value]) => ({ name, value })).sort((a,b) => b.value - a.value);
                const { valid: materialData, invalidTotal: materialUnknown } = filterUnknown(matAll);

                // Process Ranking
                const procCounts = {};
                filtered.forEach(d => procCounts[d.process] = (procCounts[d.process] || 0) + d.count);
                const procAll = Object.entries(procCounts).map(([name, value]) => ({ name, value })).sort((a,b) => b.value - a.value);
                const { valid: processData, invalidTotal: processUnknown } = filterUnknown(procAll);

                // Time
                const timeCounts = Array(24).fill(0);
                filtered.forEach(d => { if (!isNaN(d.hour)) timeCounts[d.hour] += d.count; });
                const timeData = timeCounts.map((count, hour) => ({ name: `${hour}:00`, count })).filter(d => d.count > 0);

                // Category (Pie Chart) - *‡πÄ‡∏≠‡∏≤‡∏ó‡∏∏‡∏Å‡∏≠‡∏±‡∏ô ‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏≠‡∏á* ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏±‡∏ç‡∏´‡∏≤
                const catCounts = {};
                filtered.forEach(d => catCounts[d.category] = (catCounts[d.category] || 0) + d.count);
                const categoryData = Object.entries(catCounts).map(([name, value]) => ({ name, value })).sort((a,b) => b.value - a.value);

                const years = {};
                processedData.forEach(d => { const y = d.date.split('-')[0]; if(y) years[y] = true; });
                const yearsList = Object.keys(years).sort((a,b) => b-a);

                return { total, sourceData, sourceUnknown, materialData, materialUnknown, processData, processUnknown, timeData, categoryData, yearsList };
            }, [processedData, selectedYear]);

            return (
                <div className="min-h-screen pb-20">
                    <div className="gradient-header p-6 shadow-lg mb-8 text-white">
                        <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
                            <div>
                                <h1 className="text-3xl font-bold flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>
                                    ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏õ‡∏•‡∏Å‡∏õ‡∏•‡∏≠‡∏°
                                </h1>
                                <p className="text-slate-200 text-sm mt-1">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÑ‡∏•‡∏ô‡πå‡∏ú‡∏•‡∏¥‡∏ï</p>
                            </div>
                            <div className="flex gap-2 bg-white/20 p-2 rounded-lg">
                                <span className="text-sm">‡∏õ‡∏µ:</span>
                                <select className="bg-white text-slate-800 text-sm rounded px-2 outline-none" value={selectedYear} onChange={(e) => setSelectedYear(e.target.value)}>
                                    <option value="All">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                                    {stats.yearsList.map(y => <option key={y} value={y}>{y}</option>)}
                                </select>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-4 space-y-6">
                        
                        {/* KPI Cards */}
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div className="glass-card p-5 border-l-4 border-blue-500">
                                <p className="text-xs text-slate-500 uppercase font-bold">‡∏£‡∏ß‡∏°‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏õ‡∏•‡∏Å‡∏õ‡∏•‡∏≠‡∏°</p>
                                <h3 className="text-3xl font-bold text-blue-600">{stats.total} <span className="text-sm text-slate-400">‡∏ä‡∏¥‡πâ‡∏ô</span></h3>
                            </div>
                            <div className="glass-card p-5 border-l-4 border-green-500">
                                <p className="text-xs text-slate-500 uppercase font-bold">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö (Top 1)</p>
                                <h3 className="text-xl font-bold text-green-600 truncate">{stats.materialData[0]?.name || '-'}</h3>
                                <p className="text-xs text-slate-400">({stats.materialData[0]?.value} ‡∏ä‡∏¥‡πâ‡∏ô)</p>
                            </div>
                            <div className="glass-card p-5 border-l-4 border-purple-500">
                                <p className="text-xs text-slate-500 uppercase font-bold">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô (Top 1)</p>
                                <h3 className="text-xl font-bold text-purple-600 truncate">{stats.processData[0]?.name || '-'}</h3>
                                <p className="text-xs text-slate-400">({stats.processData[0]?.value} ‡∏ä‡∏¥‡πâ‡∏ô)</p>
                            </div>
                            <div className="glass-card p-5 border-l-4 border-red-500">
                                <p className="text-xs text-slate-500 uppercase font-bold">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö (Top 1)</p>
                                <h3 className="text-xl font-bold text-red-600 truncate">{stats.sourceData[0]?.name || '-'}</h3>
                                <p className="text-xs text-slate-400">({stats.sourceData[0]?.value} ‡∏ä‡∏¥‡πâ‡∏ô)</p>
                            </div>
                        </div>

                        {/* Remarks Section */}
                        <div className="glass-card p-4 bg-yellow-50 border-yellow-200">
                            <h4 className="font-bold text-yellow-800 text-sm mb-2 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                                ‡∏à‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï (‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏/‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏≠‡∏á‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏£‡∏≤‡∏ü)
                            </h4>
                            <div className="grid grid-cols-3 gap-4 text-xs text-yellow-900">
                                <div>‚Ä¢ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏: <b>{stats.materialUnknown}</b> ‡∏ä‡∏¥‡πâ‡∏ô</div>
                                <div>‚Ä¢ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏: <b>{stats.processUnknown}</b> ‡∏ä‡∏¥‡πâ‡∏ô</div>
                                <div>‚Ä¢ ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏: <b>{stats.sourceUnknown}</b> ‡∏ä‡∏¥‡πâ‡∏ô</div>
                            </div>
                        </div>

                        {/* Chart Row 1: Material & Process (Filtered) */}
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div className="glass-card p-6">
                                <h3 className="text-lg font-bold text-slate-700 mb-4 flex items-center gap-2">üì¶ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤ (Top 10)</h3>
                                <div style={{ height: 300 }}>
                                    <ResponsiveContainer width="100%" height="100%">
                                        <BarChart data={stats.materialData.slice(0,10)} layout="vertical" margin={{ left: 20 }}>
                                            <CartesianGrid strokeDasharray="3 3" horizontal={false} />
                                            <XAxis type="number" hide />
                                            <YAxis dataKey="name" type="category" width={100} tick={{fontSize: 12}} />
                                            <Tooltip cursor={{fill: 'transparent'}} />
                                            <Bar dataKey="value" fill="#10b981" radius={[0,4,4,0]} barSize={20} label={{ position: 'right', fontSize: 11, fill: '#666' }} />
                                        </BarChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                            <div className="glass-card p-6">
                                <h3 className="text-lg font-bold text-slate-700 mb-4 flex items-center gap-2">‚öôÔ∏è ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏ö (Top 10)</h3>
                                <div style={{ height: 300 }}>
                                    <ResponsiveContainer width="100%" height="100%">
                                        <BarChart data={stats.processData.slice(0,10)} layout="vertical" margin={{ left: 20 }}>
                                            <CartesianGrid strokeDasharray="3 3" horizontal={false} />
                                            <XAxis type="number" hide />
                                            <YAxis dataKey="name" type="category" width={100} tick={{fontSize: 12}} />
                                            <Tooltip cursor={{fill: 'transparent'}} />
                                            <Bar dataKey="value" fill="#8b5cf6" radius={[0,4,4,0]} barSize={20} label={{ position: 'right', fontSize: 11, fill: '#666' }} />
                                        </BarChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                        </div>

                        {/* Chart Row 2: Pie & Source */}
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div className="glass-card p-6">
                                <h3 className="text-lg font-bold text-slate-700 mb-4 flex items-center gap-2">üç∞ ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏±‡∏ç‡∏´‡∏≤ (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)</h3>
                                <div style={{ height: 300 }}>
                                    <ResponsiveContainer width="100%" height="100%">
                                        <PieChart>
                                            <Pie 
                                                data={stats.categoryData} 
                                                dataKey="value" 
                                                nameKey="name" 
                                                cx="50%" 
                                                cy="50%" 
                                                outerRadius={80} 
                                                fill="#8884d8"
                                                label={({ cx, cy, midAngle, innerRadius, outerRadius, percent, index }) => {
                                                    const RADIAN = Math.PI / 180;
                                                    const radius = innerRadius + (outerRadius - innerRadius) * 0.5;
                                                    const x = cx + radius * Math.cos(-midAngle * RADIAN);
                                                    const y = cy + radius * Math.sin(-midAngle * RADIAN);
                                                    return percent > 0.05 ? `${(percent * 100).toFixed(0)}%` : '';
                                                }}
                                            >
                                                {stats.categoryData.map((entry, index) => (
                                                    <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                                                ))}
                                            </Pie>
                                            <Tooltip />
                                            <Legend layout="horizontal" verticalAlign="bottom" align="center" wrapperStyle={{fontSize: '11px'}} />
                                        </PieChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                            <div className="glass-card p-6">
                                <h3 className="text-lg font-bold text-slate-700 mb-4">üèÜ Top 10 ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</h3>
                                <div style={{ height: 300 }}>
                                    <ResponsiveContainer width="100%" height="100%">
                                        <BarChart data={stats.sourceData.slice(0,10)} layout="vertical" margin={{ left: 10 }}>
                                            <CartesianGrid strokeDasharray="3 3" horizontal={false} />
                                            <XAxis type="number" hide />
                                            <YAxis dataKey="name" type="category" width={100} tick={{fontSize: 11}} />
                                            <Tooltip cursor={{fill: 'transparent'}} />
                                            <Bar dataKey="value" fill="#ef4444" radius={[0,4,4,0]} barSize={15} label={{ position: 'right', fontSize: 11, fill: '#666' }} />
                                        </BarChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                            <div className="glass-card p-6">
                                <h3 className="text-lg font-bold text-slate-700 mb-4">‚è∞ ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö</h3>
                                <div style={{ height: 300 }}>
                                    <ResponsiveContainer width="100%" height="100%">
                                        <AreaChart data={stats.timeData}>
                                            <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                            <XAxis dataKey="name" tick={{fontSize: 10}} interval={2} />
                                            <YAxis tick={{fontSize: 10}} />
                                            <Tooltip />
                                            <Area type="monotone" dataKey="count" stroke="#3b82f6" fill="#93c5fd" />
                                        </AreaChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                        </div>

                        {/* Data Table */}
                        <div className="glass-card overflow-hidden">
                            <div className="p-4 bg-slate-50 border-b font-bold text-slate-700 flex justify-between items-center">
                                <span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏£‡∏¥‡∏á)</span>
                                <span className="text-xs text-gray-400">‡πÅ‡∏™‡∏î‡∏á 50 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
                            </div>
                            <div className="overflow-x-auto max-h-[400px]">
                                <table className="w-full text-sm text-left text-slate-600">
                                    <thead className="bg-white sticky top-0 shadow-sm z-10">
                                        <tr>
                                            <th className="px-6 py-3 bg-slate-100">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                            <th className="px-6 py-3 bg-slate-100">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</th>
                                            <th className="px-6 py-3 bg-slate-100">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô</th>
                                            <th className="px-6 py-3 bg-slate-100">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</th>
                                            <th className="px-6 py-3 bg-slate-100 w-1/3">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                                            <th className="px-6 py-3 bg-slate-100 text-center">‡∏£‡∏ß‡∏° (‡∏ä‡∏¥‡πâ‡∏ô)</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100 bg-white">
                                        {rawData
                                            .filter(d => selectedYear === 'All' || d.date.startsWith(selectedYear))
                                            .map((item, idx) => {
                                                const summary = getRowSummary(item.report);
                                                if(!summary) return null;
                                                const prod = detectMaterial(item.report);
                                                const proc = detectProcess(item.report);

                                                return (
                                                    <tr key={idx} className="hover:bg-slate-50 transition">
                                                        <td className="px-6 py-3 whitespace-nowrap">{item.date} <span className="text-xs text-gray-400 block">{item.time}</span></td>
                                                        <td className="px-6 py-3"><span className={`px-2 py-1 rounded text-xs ${prod.includes('‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') ? 'text-gray-400 border border-gray-200' : 'bg-green-50 text-green-700'}`}>{prod}</span></td>
                                                        <td className="px-6 py-3"><span className={`px-2 py-1 rounded text-xs ${proc.includes('‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') ? 'text-gray-400 border border-gray-200' : 'bg-purple-50 text-purple-700'}`}>{proc}</span></td>
                                                        <td className="px-6 py-3 text-blue-700 font-medium">{summary.displaySource}</td>
                                                        <td className="px-6 py-3 text-xs text-gray-500">{item.report}</td>
                                                        <td className="px-6 py-3 text-center font-bold text-slate-800">{summary.totalCount}</td>
                                                    </tr>
                                                );
                                            })
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>